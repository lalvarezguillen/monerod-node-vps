---
- name: Set up service for monerod
  become: True
  vars:
    - pruned: True
    - ban_list: ""
    - enable_dns_blocklist: ""
    - services_dir: "/etc/systemd/system"
    - memory_high: "1024M"
    - memory_max: "1536M"
  block:
    - name: create init script
      template:
        src: ./start_monerod.sh.j2
        dest: "{{ monero_dir }}/start_monerod.sh"
        group: "{{ monerod_user }}"
        owner: "{{ monerod_user }}"
        mode: "775"
      register: result_init_script
    - name: create service file
      template:
        src: ./monerod.service.j2
        dest: "{{ services_dir }}/monerod.service"
    - name: create ban list
      when: "ban_list"
      get_url:
        url: ban_list
        dest: "{{ monero_dir }}/ban_list.txt"
        group: "{{ monerod_user }}"
        owner: "{{ monerod_user }}"
        mode: "774"
      register: result_ban_list
    - name: Start service httpd, if not started
      service:
        name: monerod
        state: restarted
        enabled: True